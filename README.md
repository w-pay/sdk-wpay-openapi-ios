# Woolworths Village Wallet SDK Open API Client

As detailed in the [Woolworths Village iOS SDK](https://github.com/w-pay/sdk-wpay-ios), 
access to the APIs is facaded through an interface to allow different 
implementations to be used according to applications needs and 
technology choices.

## Requirements

The framework was developed using Xcode 11.5, Swift 5.2 and is compatible with apps targeting iOS 9.0 or above.

Running the tests requires iOS 11.0 or above.

## Getting started

TODO: Reference docs

### CocoaPods

If using [CocoaPods](https://cocoapods.org/) add the following to your Podfile

```
# substitute the tag for the version desired.
pod "VillageWalletSDKOAIClient", :git => "git@github.com:w-pay/sdk-wpay-openapi-ios.git", :tag => "v1.0.0"

# don't forget to include the SDK framework
```

### Other

Clone the repo and add the project to your XCode workspace.

## Open API implementation

The SDK can be used with an implementation of the `VillageApiRepository`
that uses the [Open API generator](https://openapi-generator.tech/) to
provide an API Client with DTOs representing the data structures of the
API. The SDK can be configured to use different libraries that the Open
API generator supports to again make it easier to embed into an existing
project with existing technology choices.

The use of an Open API implementation is a compile time choice as the
relevant libraries will all need to be included. It is not recommended to
try to use multiple implementations in the one build/app.

The current Open API implementations are:
 - `objc` - Generates a SDK for use in an XCode project.
 
Each implementation's README contains more details on how to use the
API client, however the implementations follow a naming pattern so
that it's easy to swap variants if required.
 
The Open API implementation lives in this framework so that the framework
can be consumable via CocoaPods which clones the entire Git repo. Therefore
to colocate this framework with the [generator](https://github.com/w-pay/sdk-wpay-openapi-android)
potentially cause problems. If the Open API implementation needs be updated,
use the generator and merge the changes in.
 
### Versioning

The code generated by the Open API generator should match a version of the API spec
that is supported by the SDK framework. This framework should match the major version of the
SDK framework, and the minor version where appropriate. However patch versions may differ according
to need.
 
### Generating an Open API implementation

The generator is a [Gradle](https://gradle.org/) project. See the notes in the [generator](https://github.com/w-pay/sdk-wpay-openapi-android)
project on how to generate the code.

### Building an Open API implementation with XCode
 
The Open API implementation should be included in the XCode projects framework source.
If using CocoaPods this is taken care for you by the Podspec.

### Testing an Open API implementation

There are tests in the XCode project that exercise the Open API implementation in calling
the API.

#### Dependencies

The tests require [SwiftHamcrest](https://github.com/nschum/SwiftHamcrest). If using CocoaPods
this will be installed for you.

#### Testing setup
 
The API tests make HTTP requests to a stub server to validate endpoint
IO. The tests are concerned about data structures only. The API client doesn't
care that an ID is a guid or not, it cares that a string is sent or received.

Therefore the tests are not reliant on particular data values.

Any server can be used for the API tests, however a default `api-stubs`
is available in the [generator](https://github.com/w-pay/sdk-wpay-openapi-android) repo that
uses Docker to stand up an imposter. For more details see the generator's README.

#### Running tests

1. Install dependencies (`pod install`)
2. Open `VillageWalletSDKOAIClient.xcworkspace`
3. Run Product -> Test

# TODO

- Publishing